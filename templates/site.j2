
upstream {{ item.upstream.name }} {
	server {{ item.upstream.address }}:{{ item.upstream.port }} fail_timeout={{ item.upstream.timeout }};
}

server {
	listen              443 ssl;
	server_name         {{ item.server.name }};
	ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
	ssl_certificate     {{ item.server.tls_crt_path }};
	ssl_certificate_key {{ item.server.tls_key_path}};
	location / {
		proxy_set_header  Host $host;
		proxy_set_header  X-Real-IP $remote_addr;
		proxy_set_header  X-Forwarded-Proto https;
		proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_pass        {{ item.upstream.name }};
		proxy_redirect    default;
	}
}
